# 股票查看器

在 VS Code 状态栏实时显示股票涨跌幅，支持智能搜索添加和快捷键操作。

[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Issues](https://img.shields.io/github/issues/MuWeiLiu66/stock-viewer)](https://github.com/MuWeiLiu66/stock-viewer/issues)

## 💭 设计理念

> **工作第一，看盘第二**

这款工具的核心理念是：**帮助你了解行情，而不是分散你的注意力**。

- 🎯 **极简设计** - 状态栏只显示关键信息，不会占用编辑区域
- 🔇 **静默更新** - 后台自动刷新，无弹窗、无打断
- ⚡ **快速查看** - 鼠标悬停即可查看详情，无需切换窗口
- 🎨 **可定制化** - 根据个人习惯调整显示内容，甚至可以只看涨跌方向

记住：**代码才是主业，股票只是关注**。合理使用工具，保持专注，才能既写好代码，又不错过行情。

## ✨ 核心特性

- 📊 **灵活显示** - 自由控制显示名称/价格/涨跌幅
- 🎨 **彩色显示** - 涨红跌绿，一目了然
- 🔍 **智能搜索** - 支持中文名称/编号模糊搜索添加股票
- ⚡ **快捷操作** - 常用功能配置快捷键
- 📈 **详细信息** - 悬停显示完整行情数据
- ⏸️ **智能更新** - 支持收盘时间自动停止、手动控制更新开关
- 🌍 **多市场支持** - 覆盖沪深 A 股、北交所、港股、美股、指数、ETF 等市场
- 🕐 **实时时间戳** - 显示API返回的实际数据更新时间
- 📅 **智能交易日判断** - 基于数据时间戳自动识别交易日和节假日
- 💰 **持仓盈亏** - 支持设置持仓价格和数量，实时显示参考盈利/亏损

## 🚀 快速开始

### 1. 搜索添加股票（推荐）

按 `Ctrl+Shift+F6`（Mac: `Cmd+Shift+F6`），输入股票名称或编号：

```
输入 "平安" → 找到所有包含"平安"的股票
输入 "000001" → 精确匹配编号
```

### 2. 删除股票

按 `Ctrl+Shift+F7`（Mac: `Cmd+Shift+F7`），选择要删除的股票

### 3. 手动配置

打开设置（`Ctrl+,`，Mac: `Cmd+,`），搜索 `stockViewer.stockCodes`：

```json
"stockViewer.stockCodes": [
  "平安银行",     // 支持中文名称
  "000001",       // 支持纯数字（自动识别深圳/上海）
  "sz000002",     // 完整代码格式
  "sh600000"
]
```

💡 **注意**：最多支持 7 只股票，超出部分将被自动忽略

## ⌨️ 快捷键

| 功能 | Windows/Linux | macOS |
|------|--------------|-------|
| **刷新数据** | `Ctrl+Shift+F5` | `Cmd+Shift+F5` |
| **搜索添加** | `Ctrl+Shift+F6` | `Cmd+Shift+F6` |
| **删除股票** | `Ctrl+Shift+F7` | `Cmd+Shift+F7` |
| **切换名称** | `Ctrl+Shift+F9` | `Cmd+Shift+F9` |
| **切换价格** | `Ctrl+Shift+F10` | `Cmd+Shift+F10` |
| **切换涨跌幅** | `Ctrl+Shift+F11` | `Cmd+Shift+F11` |
| **切换彩色** | `Ctrl+Shift+F12` | `Cmd+Shift+F12` |

### 💡 使用命令面板

按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）打开命令面板，输入 **"股票"** 即可看到所有可用命令：

- 股票: 刷新数据
- 股票: 搜索并添加
- 股票: 删除股票
- 股票: 显示详细信息
- 股票: 打开配置
- 股票: 切换显示名称
- 股票: 切换显示价格
- 股票: 切换显示涨跌幅
- 股票: 切换彩色显示
- 股票: 切换状态栏显示
- 股票: 切换提示气泡
- 股票: 切换数据源
- 股票: 切换自动更新
- 股票: 切换收盘停止
- 股票: 重新加载数据库
- 股票: 设置持仓信息

所有快捷键均可自定义。

## ⚙️ 主要配置

### 基础配置
| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `stockCodes` | `[]` | 股票代码列表（最多7只，超出部分自动忽略） |

### 显示设置
| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `showStockName` | `false` | 是否显示股票名称 |
| `showPrice` | `false` | 是否显示当前价格 |
| `showChangePercent` | `true` | 是否显示涨跌百分率 |
| `colorfulDisplay` | `true` | 是否彩色显示（涨红跌绿） |
| `alignment` | `right` | 显示位置：`left`（左侧）/ `right`（右侧） |
| `showStatusBar` | `true` | 是否显示状态栏股票信息（隐藏后，设置图标仍然可见） |
| `showProfitLoss` | `false` | 是否在状态栏显示参考盈利/亏损金额（需要先设置持仓信息） |

### 更新设置
| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `enableAutoUpdate` | `true` | 是否启用自动更新（总开关） |
| `updateInterval` | `8` | 更新间隔（秒），最小3秒，最大1800秒（30分钟） |
| `stopOnMarketClose` | `false` | 收盘时间自动停止请求（交易时间：周一至周五 9:15-11:30（含集合竞价）, 13:00-15:00） |

### 通知设置
| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `showNotifications` | `false` | 操作时是否显示提示气泡 |

### 持仓设置
| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `positions` | `{}` | 持仓信息对象，格式：`{"股票代码": {"costPrice": 持仓价格, "quantity": 持仓数量（手）}}`。例如：`{"sz000001": {"costPrice": 10.5, "quantity": 10}}`（10手=1000股，1手=100股） |
| `autoSetPositionOnAdd` | `false` | 添加股票后自动调用设置持仓（开启后，添加股票时会自动弹出设置持仓对话框） |

💡 **设置持仓**：使用命令面板执行 `股票: 设置持仓信息`，选择股票后输入持仓价格和数量（单位：手，1手=100股）。设置后，状态栏和详情面板会自动显示参考盈利/亏损信息。

💡 **状态栏显示参考盈利/亏损**：默认不显示，需要在设置中开启 `showProfitLoss`。开启后，如果股票已设置持仓信息，状态栏会自动显示参考盈利/亏损金额。

## 🎨 自定义图标

如需自定义扩展图标，只需将你的图标文件复制到 `icons` 文件夹：

```bash
# 将你的图标复制到 icons 文件夹，命名为 icon.png
cp /path/to/your/icon.png icons/icon.png
```

**图标要求**：
- 文件名必须为 `icon.png`
- 推荐尺寸：256x256 或 512x512 像素
- 格式：PNG（建议使用透明背景）

详细说明请参考 `icons/README.md`

## 📝 股票代码格式

### A股
- **深圳股票**：`sz000001` 或 `000001`
- **上海股票**：`sh600000` 或 `600000`
- **北交所**：`bj920001`

### 港股
- **格式**：`hk00700`（5位数字，不足5位前面补0）
- **示例**：`hk00700`（腾讯控股）、`hk09988`（阿里巴巴-SW）

### 美股
- **格式**：`us.AAPL`（标准格式）
- **示例**：`us.AAPL`（苹果）、`us.MSFT`（微软）、`us.BRK.A`（伯克希尔）

### 指数
- **格式**：`sh000001`（上证指数）、`sz399001`（深证成指）、`bj899050`（北证50）

### ETF
- **格式**：与A股相同，如 `sh510300`、`sz159919`

💡 纯数字会自动识别所属交易所（仅A股）  
💡 港美股需要使用腾讯数据源（`dataSource: 'tencent'`）

## 💡 使用技巧

### 保持专注的最佳实践

为了避免看盘影响工作效率，推荐以下配置：

1. **极简模式** - 关闭名称和价格显示，只看涨跌幅或涨跌方向
2. **适当间隔** - 建议将更新间隔设为 10-15 秒，避免频繁刷新分散注意力
3. **理性使用** - 工作时段专注编码，休息时再点击查看详细数据
4. **禁用彩色** - 如果发现红绿色容易吸引目光，可关闭彩色显示
5. **关闭提示** - 默认已关闭操作提示气泡，如需要反馈可在设置中开启 `showNotifications`
6. **智能更新** - 开启 `stopOnMarketClose` 让插件在非交易时间自动暂停更新，节省系统资源
7. **手动控制** - 需要专注工作时，可通过命令面板关闭 `enableAutoUpdate`，完全停止更新

💡 **记住**：这个工具的目的是让你安心工作，而不是时刻盯盘。

### 持仓盈亏功能

设置持仓信息后，可以实时查看参考盈利/亏损：

1. **设置持仓**：
   - 使用命令面板执行 `股票: 设置持仓信息`，选择股票后输入持仓价格和数量（单位：手，1手=100股）
   - 如果开启了 `autoSetPositionOnAdd`（默认关闭），添加股票后会自动弹出设置持仓对话框
2. **查看盈亏**：
   - 状态栏会显示参考盈利/亏损金额（需要开启 `showProfitLoss` 配置，默认关闭）
   - 悬停查看详情时会显示持仓信息和盈亏比例
   - 详情面板中会显示完整的持仓和盈亏信息
3. **参考盈利/亏损显示**：
   - 盈利显示为红色（如果开启彩色显示）
   - 亏损显示为绿色（如果开启彩色显示）
   - 显示格式：`(+1000.00元)` 或 `(-500.00元)`，大额自动转换为万元/亿元
   - 注意：这是基于当前价格的参考值，实际盈亏以实际交易为准

### 智能更新控制

插件提供了多种方式控制数据更新，帮助你在工作和关注行情之间找到平衡：

**1. 自动更新总开关** (`enableAutoUpdate`)
- 默认：开启
- 作用：完全控制是否自动更新
- 使用场景：需要全神贯注工作时，可临时关闭；仍可通过 `Ctrl+Shift+F5` 手动刷新
- 命令：`切换自动更新`

**2. 收盘时间自动停止** (`stopOnMarketClose`)
- 默认：关闭
- 作用：在非交易时间（周末、工作日盘后）自动暂停更新
- 交易时间：周一至周五 9:15-11:30（含集合竞价9:15-9:30）, 13:00-15:00
- 使用场景：盘后数据不再变化，自动停止可节省网络和系统资源
- 命令：`切换收盘时间停止请求`

**3. 更新间隔调整** (`updateInterval`)
- 默认：8秒
- 范围：3秒 - 1800秒（30分钟）
- 建议：工作时设为 10-15 秒，减少干扰；盘中关键时刻可调低至 3-5 秒；长时间不关注时可调高至 5-30 分钟

**状态提示**：

根据是否开启"显示股票名称"配置，状态栏会显示不同的格式：

| 状态 | 未开启显示名称 | 已开启显示名称 |
|------|--------------|--------------|
| 未配置股票 | 图标（编辑） | `股票: 未配置` |
| 休市中 | 图标（时钟） | `股票: 休市中` |
| 获取失败 | 图标（错误） | `股票: 获取失败` |
| 更新失败 | 图标（警告） | `股票: 更新失败` |

💡 **注意**：关闭自动更新后，状态栏仍会显示股票数据，只是不会自动刷新。你可以随时通过 `Ctrl+Shift+F5` 手动刷新。

### 显示模式切换

**默认模式**（只显示涨跌幅）：
- 彩色：<span style="color:red">+2.35%</span> <span style="color:green">-1.20%</span>（涨红跌绿）
- 纯文本：`+2.35% -1.20%`

**显示价格和涨跌幅**：
- 彩色：<span style="color:red">12.50 +2.35%</span> <span style="color:green">8.88 -1.20%</span>
- 纯文本：`12.50 +2.35% 8.88 -1.20%`

**显示名称、价格和涨跌幅**：
- 彩色：<span style="color:red">平安银行 12.50 +2.35%</span> <span style="color:green">浦发银行 8.88 -1.20%</span>
- 纯文本：`平安银行 12.50 +2.35% 浦发银行 8.88 -1.20%`

**极简模式**（价格和涨跌幅都不显示）：
- 彩色：<span style="color:red">↑</span> <span style="color:green">↓</span> <span style="color:red">↑</span>（只显示涨跌方向）
- 纯文本：`↑ ↓ ↑`

💡 开启彩色显示后，每只股票的文字会根据涨跌显示不同颜色  
💡 每只股票独立显示在状态栏，最多支持7只

**快速切换**：
- 按 `Ctrl+Shift+F9`（Mac: `Cmd+Shift+F9`） → 切换名称显示
- 按 `Ctrl+Shift+F10`（Mac: `Cmd+Shift+F10`） → 切换价格显示
- 按 `Ctrl+Shift+F11`（Mac: `Cmd+Shift+F11`） → 切换涨跌幅显示
- 按 `Ctrl+Shift+F12`（Mac: `Cmd+Shift+F12`） → 切换彩色显示

### 查看详细信息

- 鼠标悬停状态栏 → 查看当前价、涨跌额、成交量等
- 点击状态栏 → 查看完整数据表格
  - **卡片视图**：多列网格布局，适合快速浏览
  - **表格视图**：完整数据对比，方便横向比较

### 删除股票

- 按 `Ctrl+Shift+F7`（Mac: `Cmd+Shift+F7`）
- 从列表中选择要删除的股票
- 显示当前价格和涨跌幅，方便确认

## 🧪 开发与测试

本项目包含完整的单元测试，确保功能稳定可靠。

### 运行测试

```bash
# 运行所有测试
pnpm test

# 监听模式运行测试（开发时推荐）
pnpm run test:watch

# 生成测试覆盖率报告
pnpm run test:coverage
```

### 测试覆盖

- ✅ **utils.ts** - 工具函数测试（格式化、市场时间判断等）
- ✅ **config.ts** - 配置管理测试（代码验证、配置更新等）
- ✅ **stockDataService.ts** - 数据服务测试（数据解析、格式化等）
- ✅ **statusBarManager.ts** - 状态栏管理测试（显示逻辑、更新机制等）

### 测试结构

```
tests/
├── __mocks__/          # Mock 文件（VS Code API等）
│   └── vscode.ts
├── setup.ts            # 测试设置文件
├── utils.test.ts       # 工具函数测试
├── config.test.ts      # 配置管理测试
├── stockDataService.test.ts  # 数据服务测试
└── statusBarManager.test.ts  # 状态栏管理测试
```

### 编写新测试

添加新功能时，请确保：

1. 为新功能编写对应的单元测试
2. 测试覆盖核心逻辑和边界情况
3. 运行 `pnpm test` 确保所有测试通过
4. 检查测试覆盖率报告，确保覆盖率不低于现有水平

## ❓ 常见问题

**Q: 首次使用需要配置什么？**  
A: 只需添加股票代码即可，推荐使用搜索功能（`Ctrl+Shift+F6`，Mac: `Cmd+Shift+F6`）

**Q: 如何删除不需要的股票？**  
A: 按 `Ctrl+Shift+F7`（Mac: `Cmd+Shift+F7`），从列表中选择要删除的股票即可

**Q: 支持哪些股票？**  
A: 支持沪深 A 股、北交所、港股、美股、指数、ETF 等多个市场，自动缓存 7 天

**Q: 如何设置持仓信息？**  
A: 使用命令面板执行 `股票: 设置持仓信息`，选择股票后输入持仓价格和数量（单位：手，1手=100股）。设置后，状态栏和详情面板会自动显示参考盈利/亏损信息（基于当前价格的参考值）。

**Q: 持仓信息存储在哪里？**  
A: 持仓信息存储在 VS Code 的全局配置中（`stockViewer.positions`），可以通过设置界面直接编辑，格式为：`{"股票代码": {"costPrice": 持仓价格, "quantity": 持仓数量（手）}}`。例如：`{"sz000001": {"costPrice": 10.5, "quantity": 10}}` 表示10手（1000股）。

**Q: 数据多久更新一次？**  
A: 默认8秒，可在设置中调整（范围：3秒-30分钟）

**Q: 如何避免看盘影响工作？**  
A: 建议使用极简模式（只显示涨跌幅），增加更新间隔到10-15秒，工作时专注编码，只在休息时查看详情。记住：写好代码比盯着股票涨跌更重要！

**Q: 收盘后还会继续更新吗？**  
A: 默认会继续更新。如需在非交易时间自动停止更新，可在设置中开启 `stopOnMarketClose`，插件会在收盘后自动暂停，开盘时自动恢复

**Q: 如何临时暂停更新？**  
A: 打开命令面板（`Ctrl+Shift+P`，Mac: `Cmd+Shift+P`），执行 `切换自动更新` 命令即可。关闭后仍可通过 `Ctrl+Shift+F5` 手动刷新

**Q: 什么是交易时间？**  
A: A股交易时间为周一至周五的 9:15-11:30（上午，含集合竞价9:15-9:30）和 13:00-15:00（下午），节假日休市

**Q: 配置的股票代码无效会怎样？**  
A: 如果某个股票代码无法获取数据（如代码错误、退市等），系统会自动将其从配置中移除，并弹出提示告知哪些股票被移除了

**Q: 如何添加港美股？**  
A: 港美股需要使用腾讯数据源。确保 `dataSource` 设置为 `tencent`，然后使用完整代码格式添加：
- 港股：`hk00700`（5位数字）
- 美股：`us.AAPL`（标准格式）

**Q: 数据更新时间显示的是什么？**  
A: 显示的是API返回的实际数据时间戳，而非本地时间，能更准确地反映数据的时效性

**Q: 如何报告问题或提出建议？**  
A: 欢迎在 [GitHub Issues](https://github.com/MuWeiLiu66/stock-viewer/issues) 提交问题或建议

## 📄 许可证

MIT License

## 🔗 相关链接

- **GitHub 仓库**：https://github.com/MuWeiLiu66/stock-viewer
- **问题反馈**：https://github.com/MuWeiLiu66/stock-viewer/issues
- **更新日志**：查看 [CHANGELOG.md](CHANGELOG.md) 了解所有版本更新
